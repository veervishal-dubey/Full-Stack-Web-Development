<!DOCTYPE html>
<html>
<head>
  <title>Calculate | RTRWH</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<!-- Rain animation -->
<div class="rain"></div>

<!-- Navbar -->
<nav>
  <div class="logo">üåßÔ∏è RTRWH</div>
  <div>
    <a href="index.html">Home</a>
    <a href="about.html">About</a>
    <a href="calculate.html">Calculate</a>
    <a href="report.html">Report</a>
    <a href="dashboard.html">Dashboard</a>
    <a href="login.html">Login</a>
    <a href="signup.html">Signup</a>
  </div>
</nav>

<!-- Page content -->
<section class="page">
  <h1>Rainwater Harvesting Calculator</h1>

  <form id="calcForm">
    <h2>üìç Location</h2>
    <input id="city" placeholder="City">
    <input id="location" placeholder="Latitude, Longitude" readonly>

    <h2>üè† Roof Details</h2>
    <input id="length" type="number" placeholder="Roof Length (m)">
    <input id="breadth" type="number" placeholder="Roof Breadth (m)">

    <select id="material">
      <option value="">Select Material</option>
      <option value="concrete">Concrete</option>
      <option value="metal">Metal Sheet</option>
      <option value="tiles">Tiles</option>
      <option value="asbestos">Asbestos</option>
    </select>

    <select id="slope">
      <option value="">Roof Slope</option>
      <option value="flat">Flat</option>
      <option value="moderate">Moderate</option>
      <option value="steep">Steep</option>
    </select>

    <input id="runoff" placeholder="Runoff Coefficient" readonly>

    <button class="btn" type="submit">Estimate Harvest</button>
  </form>
</section>

<!-- GSAP fade-in -->
<script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/gsap.min.js"></script>
<script>
gsap.fromTo(".page",{opacity:0,y:40},{opacity:1,y:0,duration:1.2,clearProps:"all"});
</script>

<!-- Rain JS -->
<script src="js/rain.js"></script>

<!-- Calculation & geolocation JS -->
<script>
const materialSelect = document.getElementById("material");
const runoffInput = document.getElementById("runoff");

const runoffValues = {
  concrete: 0.85,
  metal: 0.9,
  tiles: 0.75,
  asbestos: 0.8
};

// Auto-fill runoff when material selected
materialSelect.addEventListener("change", () => {
  runoffInput.value = runoffValues[materialSelect.value] || "";
});

// Prompt for user's location
window.addEventListener("load", () => {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      position => {
        const lat = position.coords.latitude.toFixed(5);
        const lon = position.coords.longitude.toFixed(5);
        document.getElementById("location").value = `${lat}, ${lon}`;
        console.log("User location:", lat, lon);
      },
      error => {
        console.warn("Geolocation denied or unavailable:", error.message);
        alert("Location access denied. Please enter manually.");
      }
    );
  } else {
    alert("Geolocation is not supported by your browser.");
  }
});

// Form submission
document.getElementById("calcForm").addEventListener("submit", e => {
  e.preventDefault();
  const data = {
    city: document.getElementById("city").value,
    location: document.getElementById("location").value,
    length: document.getElementById("length").value,
    breadth: document.getElementById("breadth").value,
    material: materialSelect.value,
    slope: document.getElementById("slope").value,
    runoff: runoffInput.value
  };
  console.log("Data ready for backend:", data);

  // Example: redirect to report page
  window.location.href = "report.html";
});
</script>

</body>
</html>
